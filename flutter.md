# Flutter å…¥é—¨
> å‚è€ƒï¼š 
> [Flutterä¸­æ–‡ç½‘](https://flutterchina.club/)
> [Flutterå®æˆ˜](https://book.flutterchina.club/)

## Hybridç®€ä»‹
### H5 + åŸç”Ÿ
WebViewæ¸²æŸ“ç•Œé¢ï¼Œæ€§èƒ½ä½“éªŒè¾ƒå·®
### JSå¼€å‘ + åŸç”Ÿ 
ä»£è¡¨æ¡†æ¶React Native, Weex, å¿«åº”ç”¨, åŸç†éƒ½æ˜¯JSå»æ˜ å°„ Android | Ios åŸç”Ÿæ§ä»¶ï¼ŒåŸç”Ÿæ¸²æŸ“é€Ÿåº¦å¿«äºH5ï¼Œå—é™äºJSè§£é‡Šæ‰§è¡Œï¼Œé€Ÿåº¦æ— æ³•è¿½èµ¶åŸç”Ÿã€‚
### è‡ªç ”GUI + åŸç”Ÿ
ä»£è¡¨æ¡†æ¶QT , Flutter, æ¸²æŸ“å¼•æ“ç›´æ¥å¯¹æ¥ä¸åŒå¹³å°ç³»ç»ŸAPI, å¯¹å¤–æä¾›ç»Ÿä¸€æ¥å£ï¼Œæ€§èƒ½å’ŒåŸç”Ÿæ¥è¿‘ï¼Œä½†æ˜¯åŠ¨æ€æ€§ä¸è¶³ï¼Œéœ€è¦ç¼–è¯‘å‘åŒ…ã€‚
> PSï¼šQTåœ¨æ¡Œé¢ç«¯åº”ç”¨æ¯”è¾ƒå¹¿æ³›ï¼Œä½†æ˜¯ç§»åŠ¨ç«¯å› å¼•æ“å¤§, C++å¼€å‘æ•ˆç‡ä½ï¼Œå‘å¤šï¼Œæ¨å‡ºå³æ­»ã€‚

## Flutterç™»åœº
Flutteræ˜¯Googleå‘å¸ƒçš„ä¸€ä¸ªç”¨äºåˆ›å»ºè·¨å¹³å°ã€é«˜æ€§èƒ½ç§»åŠ¨åº”ç”¨çš„æ¡†æ¶ã€‚Flutterå’ŒQT mobileä¸€æ ·ï¼Œéƒ½æ²¡æœ‰ä½¿ç”¨åŸç”Ÿæ§ä»¶ï¼Œç›¸åéƒ½å®ç°äº†ä¸€ä¸ªè‡ªç»˜å¼•æ“ï¼Œä½¿ç”¨è‡ªèº«çš„å¸ƒå±€ã€ç»˜åˆ¶ç³»ç»Ÿã€‚
ä»¥ä¸‹æ˜¯å®˜ç½‘ä»‹ç»ï¼š
1. å¿«é€Ÿå¼€å‘
æ¯«ç§’çº§çš„çƒ­é‡è½½ï¼Œä¿®æ”¹åï¼Œæ‚¨çš„åº”ç”¨ç•Œé¢ä¼šç«‹å³æ›´æ–°ã€‚ä½¿ç”¨ä¸°å¯Œçš„ã€å®Œå…¨å¯å®šåˆ¶çš„widgetåœ¨å‡ åˆ†é’Ÿå†…æ„å»ºåŸç”Ÿç•Œé¢.

2. å¯Œæœ‰è¡¨ç°åŠ›å’Œçµæ´»çš„UI
å¿«é€Ÿå‘å¸ƒèšç„¦äºåŸç”Ÿä½“éªŒçš„åŠŸèƒ½ã€‚åˆ†å±‚çš„æ¶æ„å…è®¸æ‚¨å®Œå…¨è‡ªå®šä¹‰ï¼Œä»è€Œå®ç°éš¾ä»¥ç½®ä¿¡çš„å¿«é€Ÿæ¸²æŸ“å’Œå¯Œæœ‰è¡¨ç°åŠ›ã€çµæ´»çš„è®¾è®¡ã€‚

3. åŸç”Ÿæ€§èƒ½
FlutteråŒ…å«äº†è®¸å¤šæ ¸å¿ƒçš„widgetï¼Œå¦‚æ»šåŠ¨ã€å¯¼èˆªã€å›¾æ ‡å’Œå­—ä½“ç­‰ï¼Œè¿™äº›éƒ½å¯ä»¥åœ¨iOSå’ŒAndroidä¸Šè¾¾åˆ°åŸç”Ÿåº”ç”¨ä¸€æ ·çš„æ€§èƒ½ã€‚

4. è®¿é—®æœ¬åœ°åŠŸèƒ½å’ŒSDK
é€šè¿‡å¹³å°ç›¸å…³çš„APIã€ç¬¬ä¸‰æ–¹SDKå’ŒåŸç”Ÿä»£ç è®©æ‚¨çš„åº”ç”¨å˜å¾—å¼ºå¤§æ˜“ç”¨ã€‚ Flutterå…è®¸æ‚¨å¤ç”¨ç°æœ‰çš„Javaã€Swiftæˆ–ObjCä»£ç ï¼Œè®¿é—®iOSå’ŒAndroidä¸Šçš„åŸç”Ÿç³»ç»ŸåŠŸèƒ½å’Œç³»ç»ŸSDKã€‚

## Flutteræ€æƒ³
### ç»„åˆ
åœ¨Flutterä¸­ä¸€åˆ‡UIç›¸å…³æ“ä½œéƒ½æ˜¯Widgetï¼Œå¸ƒå±€ï¼Œå®¹å™¨ï¼Œæ‰‹åŠ¿ï¼Œæ»‘åŠ¨ï¼ŒåŠŸèƒ½éƒ½æ˜¯Widget, é€šè¿‡è‡ªç”±ç»„åˆè¿™äº›Widgetæ¥æ­å»ºåŠŸèƒ½å’Œç•Œé¢ã€‚
### å“åº”å¼ç¼–ç¨‹
å“åº”å¼ç¼–ç¨‹ä¸€å¥è¯æ€»ç»“å°±æ˜¯æ•°æ®çŠ¶æ€æ”¹å˜åˆ™UIéšä¹‹è‡ªåŠ¨æ”¹å˜ï¼Œåœ¨React Nativeå’ŒDatabingéƒ½æ˜¯è¯¥æ€æƒ³ï¼Œ åœ¨Flutterä¸­è¡¨ç°çš„æ›´åŠ æ·‹æ¼“å°½è‡´ã€‚æ•°æ®æ”¹å˜æ—¶é€šè¿‡setState() {}, é€šçŸ¥flutter frameworkæ‰§è¡Œrebuild widget -> update element -> render UIã€‚

## Flutteræ ¸å¿ƒåŸç†
è¦ä»ä¸‰é¢—ğŸŒ²è¯´èµ·...
è¿™ä¸‰é¢—ğŸŒ²åˆ†åˆ«æ˜¯ Widget Tree, Element Tree, RenderObject Tree.

### ç¬¬ä¸€é¢—WidgetğŸŒ²

``` dart
/// Describes the configuration for an [Element].
abstract class Widget extends DiagnosticableTree {
  /// Initializes [key] for subclasses.
  const Widget({ this.key });
  final Key key;
  
  @protected
  Element createElement();

  /// A short, textual description of this widget.
  @override
  String toStringShort() {
    return key == null ? '$runtimeType' : '$runtimeType-$key';
  }

  @override
  void debugFillProperties(DiagnosticPropertiesBuilder properties) {
    super.debugFillProperties(properties);
    properties.defaultDiagnosticsTreeStyle = DiagnosticsTreeStyle.dense;
  }

  /// Whether the `newWidget` can be used to update an [Element] that currently
  static bool canUpdate(Widget oldWidget, Widget newWidget) {
    return oldWidget.runtimeType == newWidget.runtimeType
        && oldWidget.key == newWidget.key;
  }
}
```
Widgetæºç æ³¨é‡Š `Describes the configuration for an [Element].`
Widgetä½œç”¨å°±æ˜¯ä¸ºElementæè¿°éœ€è¦çš„é…ç½®ï¼Œ è´Ÿè´£åˆ›å»ºElement -> `createElement()`, ä»¥åŠå†³å®šElementæ˜¯å¦éœ€è¦æ›´æ–° -> `canUpdate(Widget oldWidget, Widget newWidget)`.
Flutter frameworké€šè¿‡diffç®—æ³•æ¯”å¯¹Widgetæ ‘å˜åŒ–ï¼Œç„¶åå†³å®šElementçš„stateæ”¹å˜ã€‚rebuildåçš„widgetæ ‘ï¼Œå¦‚æœå¯¹æ¯”æœªå‘ç”Ÿæ”¹å˜ï¼Œ åˆ™Elementä¸ä¼šè§¦å‘é‡ç»˜ï¼Œè¿™å°±æ„å‘³ç€widgetæ ‘çš„é‡å»ºå¹¶ä¸ä¼šç›´æ¥å¯¼è‡´Elementæ ‘é‡å»ºã€‚

### ç¬¬äºŒé¢—ElementğŸŒ²

``` dart
/// An instantiation of a [Widget] at a particular location in the tree.
abstract class Element extends DiagnosticableTree implements BuildContext {
...
  /// The configuration for this element.
  @override
  Widget get widget => _widget;
  Widget _widget;
  
  /// The render object at (or below) this location in the tree.
  RenderObject get renderObject {
    ...
  }
...
}
```
Elementæºç æ³¨é‡Šï¼š `An instantiation of a [Widget] at a particular location in the tree.`
Elementè¡¨ç¤ºWidgeté…ç½®æ ‘ç‰¹å®šä½ç½®çš„ä¸€ä¸ªå®ä¾‹ã€‚æŒæœ‰widgetå’ŒrenderObject,è´Ÿè´£ç»„ç»‡ç®¡ç†widgeté…ç½®å’ŒrenderObjectæ¸²æŸ“ã€‚
å¯ä»¥ç†è§£ä¸ºAndroidå’ŒIOSçš„Viewæ ‘ï¼Œä½†æ˜¯ä¸åŒçš„æ˜¯ElementçŠ¶æ€ä¸€èˆ¬ç”±Flutter frameworkç®¡ç†ï¼Œ å¼€å‘è€…åªéœ€è´Ÿè´£æ›´æ”¹Widgetå³å¯ã€‚ 

### ç¬¬ä¸‰é¢—RenderObjectğŸŒ²

``` dart
/// An object in the render tree.
abstract class RenderObject extends AbstractNode with DiagnosticableTreeMixin implements HitTestTarget {
  ...
  @protected
  void performResize();

  @protected
  void performLayout();

  void paint(PaintingContext context, Offset offset);
  ...
```
RenderObjectæºç æ³¨é‡Šï¼š  `An object in the render tree.`
RenderObjectè¡¨ç¤ºä¸ºæ¸²æŸ“æ ‘çš„ä¸€ä¸ªå¯¹è±¡
é¡¾åæ€ä¹‰ï¼ŒRenderObjectè´Ÿè´£çœŸæ­£çš„æ¸²æŸ“å·¥ä½œï¼Œéœ€è¦è‡ªå·±å®šä¹‰ç»˜åˆ¶çš„è¯å°±è¦ä»æ­¤å¤„å¼€åˆ€, æµ‹é‡å¤§å° `performResize`ï¼Œå®šä½ä½ç½® `performLayout`ï¼Œ ç»˜åˆ¶ `paint`éƒ½ç”±RenderObjectå®Œæˆã€‚

### æ€»ç»“
widgetæ˜¯é…ç½®æ ‘ï¼Œ elementä¸ºUIæ§åˆ¶æ ‘ï¼Œrenderobjectä¸ºç»˜åˆ¶æ ‘ã€‚å¼€å‘è€…ç»„åˆwidgeté…ç½®ï¼Œç³»ç»Ÿframeworké€šè¿‡æ¯”å¯¹widgeté…ç½®æ¥åˆ›æ–°æ›´æ–°elementï¼Œæœ€åè°ƒåº¦RenderObjectæ¸²æŸ“æ ‘è¿›è¡Œä¸Šå±ç»˜åˆ¶ã€‚

## Widget ç§ç±»
### Stateless Widget 
æ— çŠ¶æ€Widget, ä½¿ç”¨äºä¸éœ€è¦ç»´æŠ¤çŠ¶æ€çš„åœºæ™¯ï¼Œå³åˆ›å»ºåä¸å¯ä¿®æ”¹é…ç½®æ•°æ®ã€‚

``` dart
abstract class StatelessWidget extends Widget {
  const StatelessWidget({ Key key }) : super(key: key);

  @override
  StatelessElement createElement() => StatelessElement(this);
  
  @protected
  Widget build(BuildContext context);
}
```
å¯¹åº”StatelessElementï¼Œ å…¶ä¸­BuildContextå³ä¸ºå¯¹åº”çš„Elementå®ä¾‹ã€‚
### StatefulWidget
æœ‰çŠ¶æ€widget, é€šè¿‡setState(), å¯ä»¥è§¦å‘rebuild Widget, ä»è€Œåˆ·æ–°ç•Œé¢ã€‚
é€‚ç”¨äºæ•°æ®æ”¹å˜éœ€è¦åˆ·æ–°ç•Œé¢çš„åœºæ™¯ã€‚

``` dart
abstract class StatefulWidget extends Widget {
  const StatefulWidget({ Key key }) : super(key: key);

  @override
  StatefulElement createElement() => new StatefulElement(this);

  @protected
  State createState();
}

class StatefulElement extends ComponentElement {
  StatefulElement(StatefulWidget widget)
      : _state = widget.createState(),
        super(widget) {
       }());
    assert(_state._element == null);
    _state._element = this;
    assert(_state._widget == null);
    _state._widget = widget;
    assert(_state._debugLifecycleState == _StateLifecycle.created);
  }
}

```
å¯¹åº”StatefulElementï¼Œ Stateåœ¨StatefulElementåˆå§‹åŒ–æ—¶åˆ›å»ºï¼Œ Stateå’ŒStatefulElementç›¸äº’æŒæœ‰ï¼Œæ„å‘³ç€Stateä¸ä¼šéšç€StatefulWidgeté‡å»º, StateæŒæœ‰StatefulWidget.


``` dart
class _PageWidgetState extends State<_PageWidget> {
  final GlobalKey<RefreshIndicatorState> _refreshIndicatorKey =
      GlobalKey<RefreshIndicatorState>();

  @override
  void initState() {
    super.initState();
    _refreshData();
  }

  Future _refreshData() async {
    Response response = await widget.page._request();
    setState(() {});
    return response;
  }

  @override
  Widget build(BuildContext context) {
    return RefreshIndicator(
      key: _refreshIndicatorKey,
      onRefresh: _refreshData,
    
      ...
    );
  }
```

Stateé€šè¿‡setState(), è§¦å‘rebuild.

